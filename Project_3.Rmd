---
title: "Project_3"
author: "Aaron Zelmanov"
date: "3/29/2021"
output:
  html_document:
    code_folding: hide
---
## {.tabset}

### Introduction 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(class)
library(caret)
library(gmodels)
library(InformationValue)
library(C50)

airline_train <- read.csv("train.csv")
airline_test <- read.csv("test.csv")

airline_train$X <- NULL
airline_train$id <- NULL
airline_train$Gender <- as.factor(airline_train$Gender)
airline_train$Customer.Type <- as.factor(airline_train$Customer.Type)
airline_train$Type.of.Travel <- as.factor(airline_train$Type.of.Travel)
airline_train$Class <- as.factor(airline_train$Class)
airline_train$satisfaction <- as.numeric(as.factor(airline_train$satisfaction))-1

airline_test$X <- NULL
airline_test$id <- NULL
airline_test$Gender <- as.factor(airline_test$Gender)
airline_test$Customer.Type <- as.factor(airline_test$Customer.Type)
airline_test$Type.of.Travel <- as.factor(airline_test$Type.of.Travel)
airline_test$Class <- as.factor(airline_test$Class)
airline_test$satisfaction <- as.numeric(as.factor(airline_test$satisfaction))-1
```
**Context:** We are working with the airline dataset which contains various demographics and flight information along with the final satisfaction level.  

**Audience:** The results of our models are useful for airlines in order to optimize their flight experience and lead to maximum satisfaction. 

**Key Business Objectives:** What factors are predictive of a satisfied or dissatisfied passenger? How can airlines use this information to improve certain aspects of service? How can airlines predict who to invest more in (dissatisfied passengers)? 

```{r}
#Train and Test sets to use 

#airline_train FOR decision tree, regression
#airline_test FOR decision tree, regression
#airline_train_factorized_normalized FOR KNN, ANN
#airline_test_factorized_normalized FOR KNN, ANN

normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x))) #everything 0 to 1
}

airline_train_factorized<- as.data.frame(model.matrix(~.-1, data = airline_train))
airline_train_factorized_normalized <- as.data.frame(lapply(airline_train_factorized[1:ncol(airline_train_factorized)], normalize))
airline_factorizednormalized_trainlabels <- airline_train_factorized_normalized["satisfaction"]

airline_test_factorized<- as.data.frame(model.matrix(~.-1, data = airline_test))
airline_test_factorized_normalized <- as.data.frame(lapply(airline_test_factorized[1:ncol(airline_test_factorized)], normalize))
airline_factorizednormalized_testlabels <- airline_test_factorized_normalized["satisfaction"]
```

### Data Exploration 

```{r}

# #Correlations with satisfaction 
# correlations <- as.data.frame(cor(airline_train[sapply(airline_train, function(x) is.numeric(x))])[19,])
# #correlations %>% ggplot(aes(x=reorder(rownames(correlations), correlations[,1]), y=correlations[,1])) + 
# geom_bar(stat = 'identity') + ggtitle("Correlations with Satisfaction") + labs(x="Variables", y="Correlation") + theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90))

```


### Regression 

```{r}
logit_model <- glm(satisfaction ~., data = airline_train, family = "binomial")
summary(logit_model)

prediction <- predict(logit_model, newdata = airline_test, type = "response")

#optimal <- optimalCutoff(airline_test$satisfaction, prediction)[1]

#binary_predictions <- ifelse(prediction > optimal, 1, 0)

#airline_test_labels <- airline_test[airline_test, "satisfaction"]

#CrossTable(x = airline_test$satisfaction, y = binary_predictions, prop.chisq = FALSE)
```

### KNN

### ANN

### Decision Tree 

```{r}
airline_test$satisfaction <- as.factor(airline_test$satisfaction)
airline_train$satisfaction <- as.factor(airline_train$satisfaction)

airline_decision <- C5.0(satisfaction ~ ., data = airline_train)
airline_decision_pred <- predict(airline_decision, newdata = airline_test)

CrossTable(airline_test$satisfaction, airline_decision_pred)
airline_decision_pred <- as.factor(airline_decision_pred)
caret::confusionMatrix(airline_test$satisfaction, airline_decision_pred)


```


### SVM 

### Combined Model 

### Conclusion 
